<!DOCTYPE html>
<html lang="en-gb">
<head>
    <title>Full Text Indexing with Zend_Search_Lucene &middot; Mildly Skilled</title>
    <meta name="generator" content="Hugo 0.25.1" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="author" content="Kwabena Aning">
    
      <meta name="description" content="">
    
    
    <link rel="canonical" href="../../posts/2010-07-30-full-text-indexing-with-zend_search_lucene/"/>
    <link rel="icon" href="favicon.ico">
    <link rel="apple-touch-icon" href="apple-touch-icon.png"/>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/monokai.css">
    <link rel="stylesheet" href="fancybox/jquery.fancybox.css">
    
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,400,600' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Source+Code+Pro' rel='stylesheet' type='text/css'>
    <meta property="og:title" content="Full Text Indexing with Zend_Search_Lucene" />
<meta property="og:description" content="To provide a robust search facility for content you have stored on a MySQL database, you may be thinking of using MySQLs builting full text indexing facility. This comes with the MyISAM storage engine and can be slightly limiting especially if you would like to use foreign keys and such. So queries such has the following:
 &quot;SELECT *, MATCH (page_content, page_title) AGAINST (:keywords IN BOOLEAN MODE) AS relevance FROM pages WHERE MATCH (page_content, page_title) AGAINST (:keywords2 IN BOOLEAN MODE) ORDER BY relevance DESC&quot;;  may not work for you although this may be how you want to go." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/2010-07-30-full-text-indexing-with-zend_search_lucene/" />



<meta property="article:published_time" content="2010-07-30T14:15:42&#43;01:00"/>
<meta property="article:modified_time" content="2010-07-30T14:15:42&#43;01:00"/>











    
    
<meta itemprop="name" content="Full Text Indexing with Zend_Search_Lucene">
<meta itemprop="description" content="To provide a robust search facility for content you have stored on a MySQL database, you may be thinking of using MySQLs builting full text indexing facility. This comes with the MyISAM storage engine and can be slightly limiting especially if you would like to use foreign keys and such. So queries such has the following:
 &quot;SELECT *, MATCH (page_content, page_title) AGAINST (:keywords IN BOOLEAN MODE) AS relevance FROM pages WHERE MATCH (page_content, page_title) AGAINST (:keywords2 IN BOOLEAN MODE) ORDER BY relevance DESC&quot;;  may not work for you although this may be how you want to go.">


<meta itemprop="dateModified" content="2010-07-30T14:15:42&#43;01:00" />
<meta itemprop="wordCount" content="528">



<meta itemprop="keywords" content="Zend,PHP," />

    

  <meta name="twitter:card" content="summary"/>



<meta name="twitter:text:title" content="Full Text Indexing with Zend_Search_Lucene"/>
<meta name="twitter:title" content="Full Text Indexing with Zend_Search_Lucene"/>
<meta name="twitter:description" content="To provide a robust search facility for content you have stored on a MySQL database, you may be thinking of using MySQLs builting full text indexing facility. This comes with the MyISAM storage engine and can be slightly limiting especially if you would like to use foreign keys and such. So queries such has the following:
 &quot;SELECT *, MATCH (page_content, page_title) AGAINST (:keywords IN BOOLEAN MODE) AS relevance FROM pages WHERE MATCH (page_content, page_title) AGAINST (:keywords2 IN BOOLEAN MODE) ORDER BY relevance DESC&quot;;  may not work for you although this may be how you want to go."/>
<meta name="twitter:site" content="@KwabenaAning"/>

    

    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
</head>
<body>
<div class="container">


<div id="container">
	<header id="header">
  <div id="header-main" class="header-inner">
    <div class="outer">
      <a href="" id="logo">
          
          <span class="site-title">Mildly Skilled</span>
      </a>
      <nav id="main-nav">
          
          
          <a class="main-nav-link" href="../../">Home</a>
          
          
          
          

          

          
          
          
          
          <a class="main-nav-link" href="../../">Tags</a>
          
          
      </nav>
        <nav id="sub-nav">
          <div class="profile" id="profile-nav">
            <a id="profile-anchor" href="javascript:;"><img class="avatar" src="css/images/avatar.png"><i class="fa fa-caret-down"></i></a>
          </div>
        </nav>
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form">
              <input type="search" name="q" class="search-form-input" placeholder="Search">
              <button type="submit" class="search-form-submit">
              </button>
              <input type="hidden" name="sitesearch" value="" />
         </form>
        </div>
    </div>
  </div>
  <div id="main-nav-mobile" class="header-sub header-inner">
    <table class="menu outer">
      <tbody>
          <tr>
          
          
          <td><a class="main-nav-link" href="../../">Home</a></td>
          
          
          
          

          

          
          
          
          
          <td><a class="main-nav-link" href="../../">Tags</a></td>
          
          
          <td>
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form">
          <input type="search" name="q" class="search-form-input" placeholder="Search">
          <input type="hidden" name="sitesearch" value="" />
          </form>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</header>

   	
   	<div class="outer">
   	
    	<aside id="profile">
  <div class="inner profile-inner">
    <div class="base-info profile-block">
      
      <img id="avatar" src="https://www.gravatar.com/avatar/d6af1205bdeb5491f9c58096a858290d?s=100&d=identicon"/>
      
      <h2 id="name">Kwabena Aning</h2>
      
      
      
          <a id="follow" href="https://github.com/mildlyskilled">
              Follow
          </a>
      
    </div>
    <div class="article-info profile-block">
      <div class="article-info-block">
        0
        <span>Posts</span>
      </div>
      <div class="article-info-block">
        
          22
        
        <span>
            Tags
        </span>
      </div>
    </div>
    <div class="profile-block social-links">
      <table>
        <tr>
          
<td><a href="//github.com/mildlyskilled" target="_blank" title="GitHub"><i class="fa fa-github"></i></a></td>





















<td><a href="//instagram.com/KwabenaAning" target="_blank" title="Instagram"><i class="fa fa-instagram"></i></a></td>

















<td><a href="//linkedin.com/in/kaning" target="_blank" title="LinkedIn"><i class="fa fa-linkedin"></i></a></td>















<td><a href="//twitter.com/KwabenaAning" target="_blank" title="Twitter"><i class="fa fa-twitter"></i></a></td>


          <td><a href="../../index.xml" target="_blank" title="RSS"><i class="fa fa-rss"></i></a></td>
        </tr>
      </table>
    </div>
  </div>
</aside>

    

    <section id="main">
    
    <article id="page-undefined" class="article article-type-page" itemscope="" itemprop="blogPost">
    <div class="article-inner">
        

        <header class="article-header">
    <a href="../../posts/2010-07-30-full-text-indexing-with-zend_search_lucene/">
    <h1 class="article-title" itemprop="name">
        Full Text Indexing with Zend_Search_Lucene
    </h1>
    </a>
    <div class="article-meta">

        
        <div class="article-date">
            <i class="fa fa-calendar"></i>
            <time datetime="2010-07-30 14:15:42 &#43;0100 BST" itemprop="datePublished">Fri, 30 July 2010</time>
            &middot;
            528
            words
            &middot;
            3
            minute read
        </div>
        
        

        
            
            
            <div class="article-category">
                <i class="fa fa-tags"></i>
                
                
                <a class="article-category-link" href="tags/zend">Zend</a>
                &middot;
                
                
                <a class="article-category-link" href="tags/php">PHP</a>
                
                
            </div>
            
        
    </div>
</header>

        <div class="article-entry" itemprop="articleBody">
            <p>To provide a robust search facility for content you have stored on a MySQL database, you may be thinking of using MySQLs builting full text indexing facility. This comes with the MyISAM storage engine and can be slightly limiting especially if you would like to use foreign keys and such. So queries such has the following:</p>

<pre><code> &quot;SELECT *, MATCH (page_content, page_title) AGAINST
(:keywords IN BOOLEAN MODE) AS relevance
FROM pages WHERE MATCH (page_content, page_title) AGAINST
(:keywords2 IN BOOLEAN MODE) ORDER BY relevance DESC&quot;;
</code></pre>

<p>may not work for you although this may be how you want to go.</p>

<p>The best way I have found is to leave the indexing to another service in general. Enter Zend_Search_Lucene, i believe this is a PHP port of the Apache Lucene project written in Java&hellip;.</p>

<p>So basically we start by creating our index and document, personally i like to remove my personal classes and all that from the Zend Application as often as I can that way it&rsquo;s mostly untainted and I can then use the same Zend Application with multiple custom code bases, enough on that already. However you chose to go you need a version of the following:</p>

<pre><code>class My_SearchService {

    protected
    $indexPath,
    $pageService,
    $pageIndexPath,
    $newsIndexPath,
    $document,
    $pageIndex;

    public function setIndexPath($indexPath) {
        $this-&gt;indexPath = $indexPath;
    }

    public function __construct($indexPath = NULL) {
        if (is_null($indexPath)) {
            $indexPath = APPLICATION_PATH . '/indexes/';
        }
        $this-&gt;setIndexPath($indexPath);
        $this-&gt;pageIndexPath = $this-&gt;indexPath . 'pageindex';
        $this-&gt;newsindexPath = $this-&gt;indexPath . 'newsindex';
        $this-&gt;pageService = new My_PageService();
    }

    public function createPageIndex() {
        $this-&gt;pageIndex = Zend_Search_Lucene::create($this-&gt;pageIndexPath);
// this is a simple Zend_Db_Table object returning data from my database
        $pages = $this-&gt;pageService-&gt;getAllPages()-&gt;toArray();

        foreach ($pages as $page) {
            $this-&gt;pageIndex
-&gt;addDocument(new My_Controller_Plugin_PageIndexer($page));
        }

        // commit index
        $this-&gt;pageIndex-&gt;commit();
    }

}
</code></pre>

<p>This is assuming you have a folder structure that looks a bit like</p>

<p>/applications
&ndash;/everything else here
/library
&ndash;/My
&ndash;/PageService.php
&mdash;&ndash;/Controller
&mdash;&mdash;&mdash;-/Plugin
&mdash;&mdash;&mdash;&mdash;&ndash;/PageIndexer.php</p>

<p>Our PageIndexer is just out extension of Zend_Search_Lucene_Document this is what we will be querying for all our page search needs.</p>

<pre><code>/**
 * Description of PageIndexer
 *
 * @author kaning
 */
class STEMNET_Controller_Plugin_PageIndexer extends Zend_Search_Lucene_Document {

    /**
     * Constructor. Creates our indexable document and adds all
     * necessary fields to it using the passed in document
     */
    public function __construct($document) {
       $this-&gt;addField(Zend_Search_Lucene_Field::Keyword('page_id', $document['page_id']));
        $this-&gt;addField(Zend_Search_Lucene_Field::UnIndexed('name', $document['page_name']));
        $this-&gt;addField(Zend_Search_Lucene_Field::UnIndexed('created', $document['publishdate']));
        $this-&gt;addField(Zend_Search_Lucene_Field::UnIndexed('caption', $document['page_caption']));
        $this-&gt;addField(Zend_Search_Lucene_Field::Text('title', $document['page_title']));
        $this-&gt;addField(Zend_Search_Lucene_Field::UnStored('content', $document['page_content']));
    }

}
</code></pre>

<p>Not much introduction here besides the fact that I am adding the fields I want in my index bear in mind that the field data I am adding simply corresponds to what the Zend_Db_table select query returned for me.</p>

<p>Bear in mind that you really need to create the index only once. You will be updating it in subsequent times.</p>

<p>I formed the basis of this post from this <a href="http://www.phpriot.com/articles/zend-search-lucene">tutorial.</a> Look it up for more information</p>

<p>class STEMNET_SearchService {</p>

<p>protected
$indexPath,
$pageService,
$pageIndexPath,
$newsIndexPath,
$document,
$pageIndex;</p>

<p>public function setIndexPath($indexPath) {
$this-&gt;indexPath = $indexPath;
}</p>

<p>public function __construct($indexPath = NULL) {
if (is_null($indexPath)) {
$indexPath = APPLICATION_PATH . &lsquo;/indexes/&rsquo;;
}
$this-&gt;setIndexPath($indexPath);
$this-&gt;pageIndexPath = $this-&gt;indexPath . &lsquo;pageindex&rsquo;;
$this-&gt;newsindexPath = $this-&gt;indexPath . &lsquo;newsindex&rsquo;;
$this-&gt;pageService = new STEMNET_PageService();
}</p>

<p>public function createPageIndex() {
$this-&gt;pageIndex = Zend_Search_Lucene::create($this-&gt;pageIndexPath);
$pages = $this-&gt;pageService-&gt;getAllPages();</p>

<p>foreach ($pages as $page) {
$this-&gt;pageIndex-&gt;addDocument(new STEMNET_Controller_Plugin_PageIndexer($page));
}</p>

<p>// commit index
$this-&gt;pageIndex-&gt;commit();
}</p>

<p>}</p>

        </div>
        <footer class="article-footer">
    <a data-url="/posts/2010-07-30-full-text-indexing-with-zend_search_lucene/" data-id="38c0cbbb9455bcffe6fdf9bfb75f902d" class="article-share-link">
        <i class="fa fa-share"></i>
        Share
    </a>
    

    <script>
    (function ($) {
        
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
    </script>
</footer>

    </div>

    
<nav id="article-nav">
    
    <a href="../../posts/2010-07-28-a-question-on-zend_acls/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">
          Older
      </strong>
      <div class="article-nav-title">A question on Zend_Acls</div>
    </a>
    

    
    <a href="../../posts/2010-09-06-mod_rewrite-and-zend-framework-1-10-x-and-ubuntu/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">
          Newer
      </strong>
      <div class="article-nav-title">Mod_Rewrite and Zend Framework 1.10.x and Ubuntu</div>
    </a>
    
</nav>


</article>



    </section>

   	
    	<aside id="sidebar">
    
<div class="widget-wrap">
    <h3 class="widget-title">
        Recents
    </h3>
    <div class="widget">
        <ul id="recent-post">
            
        </ul>
    </div>
</div>


    





    


<div class="widget-wrap">
    <h3 class="widget-title">
        Tags
    </h3>
    <div class="widget">
        <ul class="category-list">
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="tags/android">
                    android
                </a>
                <span class="category-list-count">1</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="tags/api">
                    api
                </a>
                <span class="category-list-count">2</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="tags/content">
                    content
                </a>
                <span class="category-list-count">1</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="tags/django">
                    django
                </a>
                <span class="category-list-count">1</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="tags/heroku">
                    heroku
                </a>
                <span class="category-list-count">1</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="tags/laravel">
                    laravel
                </a>
                <span class="category-list-count">1</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="tags/latex">
                    latex
                </a>
                <span class="category-list-count">3</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="tags/life">
                    life
                </a>
                <span class="category-list-count">1</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="tags/linux">
                    linux
                </a>
                <span class="category-list-count">5</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="tags/mobile">
                    mobile
                </a>
                <span class="category-list-count">3</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="tags/mokocharlie">
                    mokocharlie
                </a>
                <span class="category-list-count">2</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="tags/mysql">
                    mysql
                </a>
                <span class="category-list-count">1</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="tags/pearls">
                    pearls
                </a>
                <span class="category-list-count">1</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="tags/php">
                    php
                </a>
                <span class="category-list-count">8</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="tags/proguard">
                    proguard
                </a>
                <span class="category-list-count">1</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="tags/python">
                    python
                </a>
                <span class="category-list-count">1</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="tags/react">
                    react
                </a>
                <span class="category-list-count">1</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="tags/scala">
                    scala
                </a>
                <span class="category-list-count">3</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="tags/scalatra">
                    scalatra
                </a>
                <span class="category-list-count">1</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="tags/slick">
                    slick
                </a>
                <span class="category-list-count">1</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="tags/ubuntu">
                    ubuntu
                </a>
                <span class="category-list-count">4</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="tags/zend">
                    zend
                </a>
                <span class="category-list-count">6</span>
            </li>
            
        </ul>
    </div>
</div>




    


<div class="widget-wrap">
    <h3 class="widget-title">
        Tag cloud
    </h3>
    <div class="widget tagcloud">
        
        
        <a href="tags/android" style="font-size: 12px;">android</a>
        
        
        <a href="tags/api" style="font-size: 12px;">api</a>
        
        
        <a href="tags/content" style="font-size: 12px;">content</a>
        
        
        <a href="tags/django" style="font-size: 12px;">django</a>
        
        
        <a href="tags/heroku" style="font-size: 12px;">heroku</a>
        
        
        <a href="tags/laravel" style="font-size: 12px;">laravel</a>
        
        
        <a href="tags/latex" style="font-size: 12px;">latex</a>
        
        
        <a href="tags/life" style="font-size: 12px;">life</a>
        
        
        <a href="tags/linux" style="font-size: 12px;">linux</a>
        
        
        <a href="tags/mobile" style="font-size: 12px;">mobile</a>
        
        
        <a href="tags/mokocharlie" style="font-size: 12px;">mokocharlie</a>
        
        
        <a href="tags/mysql" style="font-size: 12px;">mysql</a>
        
        
        <a href="tags/pearls" style="font-size: 12px;">pearls</a>
        
        
        <a href="tags/php" style="font-size: 12px;">php</a>
        
        
        <a href="tags/proguard" style="font-size: 12px;">proguard</a>
        
        
        <a href="tags/python" style="font-size: 12px;">python</a>
        
        
        <a href="tags/react" style="font-size: 12px;">react</a>
        
        
        <a href="tags/scala" style="font-size: 12px;">scala</a>
        
        
        <a href="tags/scalatra" style="font-size: 12px;">scalatra</a>
        
        
        <a href="tags/slick" style="font-size: 12px;">slick</a>
        
        
        <a href="tags/ubuntu" style="font-size: 12px;">ubuntu</a>
        
        
        <a href="tags/zend" style="font-size: 12px;">zend</a>
        
    </div>
</div>





    <div id="toTop" class="fa fa-angle-up"></div>
</aside>

    
	</div>
</div>

<footer id="footer">
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017
      
    </div>
  </div>
</footer>


<script src="fancybox/jquery.fancybox.pack.js"></script>
<script src="js/script.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>


<script>hljs.initHighlightingOnLoad();</script>





</body>
</html>